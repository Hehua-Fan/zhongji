# 智能排班排产系统

一个基于Python FastAPI后端和Next.js前端的智能排班排产系统，支持按岗位排班和生产排程功能。

## 🚀 系统概述

### 主要功能
- **按岗位排班**: 根据技能矩阵、岗位需求和人员配置进行智能排班
- **生产排程**: 支持多种排产规则的生产计划调度
- **效果评价**: 人岗匹配度和工时利用率分析
- **请假调整**: 智能生成人员调整建议
- **数据可视化**: 直观的排班结果展示和统计分析

### 技术栈
- **后端**: Python 3.x, FastAPI, Pandas, Pydantic
- **前端**: Next.js 14, React, TypeScript, Tailwind CSS
- **数据处理**: Excel文件读取，JSON API交互

## 📦 安装和启动

### 前置条件
- Python 3.8+
- Node.js 18+
- Conda 环境管理器

### 1. 后端服务启动

```bash
# 进入后端目录
cd backend

# 激活conda环境
conda activate zhongji

# 安装依赖（如果尚未安装）
pip install -r requirements.txt

# 启动后端服务
python start.py
```

后端服务将运行在: http://localhost:8000
- API文档: http://localhost:8000/docs
- 健康检查: http://localhost:8000/health

### 2. 前端服务启动

```bash
# 进入前端目录
cd frontend

# 安装依赖（如果尚未安装）
npm install

# 启动前端服务
npm run dev
```

前端服务将运行在: http://localhost:3000

## 🎯 使用指南

### 1. 数据准备

系统需要以下三个Excel文件：

#### a. 基础箱型库.xlsx
包含产品和岗位需求信息：
- 产成品编码 (列A)
- 岗位编码 (列E) 
- 需求人数 (列Q)

#### b. 岗位图谱.xlsx
包含岗位技能要求：
- 工作中心 (列C)
- 岗位编码 (列F)
- 岗位技能等级 (列M)

#### c. 技能矩阵.xlsx
包含员工技能信息：
- 姓名, 工号, 班组
- 各岗位技能等级 (数值型)

### 2. 排班操作流程

#### 单日排班
1. 上传三个Excel数据文件
2. 输入产品SKU代码
3. 点击"今日排班"按钮
4. 查看排班结果和效果评价

#### 一周排班
1. 准备好数据文件
2. 点击"一周排班"按钮
3. 系统自动生成本周7天的排班计划
4. 可切换到周视图查看整体安排

### 3. 功能模块说明

#### 数据上传模块
- 支持.xlsx格式文件上传
- 实时验证文件格式和数据完整性
- 显示上传状态和统计信息

#### 排班视图模块
- 日视图/周视图切换
- 多维度筛选 (岗位、工作中心、班组、状态)
- 排班结果表格展示
- Excel文件导出功能

#### 效果评价模块
- **人岗匹配度分析**: 计算员工技能与岗位要求的匹配程度
- **工时利用率分析**: 评估人员配置的效率
- **培养计划**: 自动生成技能提升建议
- **优化方案**: 提供改进建议

#### 请假调整模块
- 请假信息录入
- 班组负荷分析
- 智能调整建议生成
- 效率影响评估

## 🔧 API接口

### 排班相关
- `POST /scheduling/day` - 单日排班
- `POST /scheduling/week` - 一周排班
- `POST /scheduling/performance` - 性能指标计算
- `POST /scheduling/team-workloads` - 班组负荷计算

### 排产相关
- `POST /production/schedule` - 生产排程
- `POST /production/optimize` - 排程优化
- `POST /production/gantt` - 甘特图数据
- `POST /production/summary` - 排程摘要

### 通用工具
- `GET /health` - 健康检查
- `GET /algorithms/scheduling-rules` - 排班规则
- `GET /algorithms/production-rules` - 排产规则
- `POST /data/validate` - 数据验证

## 📊 算法说明

### 排班算法
1. **技能匹配**: 优先分配技能等级满足要求的员工
2. **班组均衡**: 保持班组内人员分配相对均衡  
3. **负荷均衡**: 避免个别岗位过度集中或不足

### 排产算法
- **FIFO**: 先进先出，按订单接收时间排序
- **SPT**: 最短时间优先，优先安排加工时间短的订单
- **EDD**: 最早交期优先，优先安排交期最近的订单
- **CR**: 关键比率优先，基于剩余时间和加工时间比率

### 评价指标

#### 人岗匹配度
```
总体匹配度 = 满足要求总人数 / 总人数 × 100%
岗位匹配度 = 满足要求人数 / 岗位总人数 × 100%
```

#### 工时利用率
```
总体利用率 = (实际配置工时 / 需求工时) × 100%
实际配置工时 = 已排人数 × 标准工时
需求工时 = 需求人数 × 标准工时
```

## 🧪 测试功能

访问 http://localhost:3000/test 可以进行API连通性测试：
- 健康检查API测试
- 排班API功能测试
- 实时查看请求和响应数据

## 🔍 故障排除

### 常见问题

1. **后端服务启动失败**
   - 检查Python环境和依赖包
   - 确认端口8000未被占用
   - 查看控制台错误信息

2. **前端页面无法访问**
   - 检查Node.js版本 (>=18)
   - 重新安装依赖: `npm install`
   - 检查端口3000是否可用

3. **API调用失败**
   - 确认CORS配置正确
   - 检查网络连接
   - 验证请求数据格式

4. **文件上传问题**
   - 确保Excel文件格式为.xlsx
   - 检查文件数据结构是否正确
   - 查看浏览器控制台错误信息

## 📈 系统监控

### 服务状态检查
```bash
# 后端健康检查
curl http://localhost:8000/health

# 前端页面检查  
curl -I http://localhost:3000

# 排班页面检查
curl -I http://localhost:3000/paiban
```

### 性能监控
- 系统会自动计算并显示排班效率指标
- 支持导出排班结果进行离线分析
- 提供详细的错误日志和调试信息

## 🤝 开发者信息

- **系统架构**: 前后端分离，RESTful API设计
- **数据流**: Excel → 后端处理 → API响应 → 前端展示
- **扩展性**: 模块化设计，支持新增算法和功能

## 📞 支持联系

如有问题或建议，请通过以下方式联系：
- 技术支持: 查看系统日志和错误信息
- 功能建议: 提交功能需求说明
- 使用培训: 参考本文档和测试页面示例

---

✅ **系统已完成部署并正常运行**
- 后端服务: http://localhost:8000 ✅
- 前端界面: http://localhost:3000 ✅  
- 排班功能: http://localhost:3000/paiban ✅
- API测试: http://localhost:3000/test ✅ 